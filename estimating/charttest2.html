<html>

<head>
<script src="../assets/js/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0/dist/Chart.min.js" 
integrity="sha256-Uv9BNBucvCPipKQ2NS9wYpJmi8DTOEfTA/nH2aoJALw=" crossorigin="anonymous"></script>
<script src="../assets/js/mychart.js"></script>
</head>
<body>


<div id="simulation" />

<script type="text/javascript">
function stddev(range, mean, variance) {
	const factor = 1 / (Math.sqrt(2* 3.141592 * variance));
	return range.map(r => {
		const num= ((r - mean)*(r - mean));
		const denom = 2 * variance;
		const fact = num / denom;
		
		return factor * Math.exp(-fact);
	});
}

function random_normal() 
{  
  const M_PI = 3.14159;	
  return Math.sqrt(-2*Math.log(Math.random())) * Math.cos(2*M_PI*Math.random());
}

var mean = 5;
var variance = 2.5

const samples = range(0, 200, 1).map(i => random_normal()*variance+mean);

function bucket(samples) {
	var out = new Array(20).fill(0);
	samples.forEach(s => {
		var b = Math.round(s) + mean;
		if ((b>=0) && (b<20)) {
			out[b] ++;
		}
	});
	return out;
}
function calcMean(s) {
	var tot = s.reduce((a,b) => a+b);
	var len = s.length;
	return tot/len;
}

function calcVar(s, mean) {
	var tot = s.map(i => (i - mean)*(i - mean)).reduce((a, b) => a+b);
	var len = s.length - 1;
	return tot / len;
}

doChart('simulation', 
 {
   'samples' : { min: 1, max: 200, value: 1, name: 'Individual Samples', step: 1 },
 },
 [
	 model => { 
		 var subsam = samples.slice(0, model.samples.value);
		 var mean = calcMean(subsam);
		 var variance = calcVar(subsam, mean);
		 var buckets = bucket(subsam);
		 
		 return {
		    data: {
		    	type: 'bar',
			    labels: range(0, 20, 1),
		        datasets: [{
		            label: 'Samples',
		            data: buckets,
		            borderWidth: 1,
		            type: 'bar'
		        },
		        ]
		    },
		    options: {
		        maintainAspectRatio: false,
		        scales: {
		            yAxes: [{
		                ticks: {
		                    beginAtZero: true,
		                    max: 20,
		                    min: 0
		                },
		                position: 'left'
		            },
		            {
		            	ticks: {
		                    beginAtZero: true,
		                    max: 5,
		                    min: 0
		                },
		                position: 'right'
		            }],
		            xAxes: [{
		            	ticks: {
		            		min: 0,
		            		max: 20
		            	},
		            }]
		        }
		    }
		}}]);

</script>
</body>
</html>